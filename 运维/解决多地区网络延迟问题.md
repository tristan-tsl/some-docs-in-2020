# **发现问题**

## **定位问题**

目前存在服务服务于多个地区, 而服务器中心化部署导致边远地区访问网络延迟严重, 例如东北地区

频繁更新前端, 导致需要频繁更新拉取前端文件, 网页第一次打开拉取js文件过多过大, 导致网站打开卡顿严重

通过地图寻点测试距离: 深圳到郑州1359公里

​            ![img](https://docimg9.docs.qq.com/image/n3qFkhOgYdRikKbSulpoKg?w=1920&h=975)            

## **衡量程度:**

在解决问题前需要先衡量问题程度, 即需要先测试程度严重的地区的网络延迟时间(单位毫秒), 使用二分法方式逐步解决, 需要和实施沟通

如何测试网络延迟?边远地区访问时间 - 本地访问时间=网络延迟时间

本地电脑上连公司网络, 打开cmd控制台输入tracert 域名 并回车执行, 后台等待执行完成

前端统一采集网络访问情况, 前端集成skywalking-client-js(https://github.com/apache/skywalking-client-js), 统一采集网络延迟情况



# **解决问题:**

分为前端和后端两个点去解决

以后的变更需要与结合业务结合, 不再只是单一通用的运维脚本



## **前端:**

使用全国CDN加速域名[阿里云]

数据文件使用OSS存储, 定时备份

首次打开时使用统一的欢迎使用加载图片代替白屏

所有网络加载动作前播放加载图片动画

## **后端:**

### **解决方案一:** 

服务多地区部署, 需要购买各个地区的服务器

缺点: 服务器/运维管理成本高、性价比低

优点: 解决问题彻底, 服务效果最好

同时针对一些中间件需要也需要这样改造, 风险大



### **解决方案二:**

在多地区购买小型服务器, 该服务器上部署代理服务, 指向中心服务, 由中心服务提供服务

从长距离网络使用直线内网代理上进行优化

缺点: 解决程度有限

优点: 服务器/运维管理成本略低、性价比高



### **解决方案三: (目前选择)**

基于解决方案二:

在边远地区部署kubernetes节点, 仍然由kubernetes进行管理服务器集群, 使用SDN网络, 在这些节点上部署ingress网关, 走内部SDN网络到正式环境服务, 由中心服务集群提供服务

缺点: 需要额外的运维管理

优点: 相比于方案二性能略好



### **解决方案四:**

在方案三的基础上, 直接在边远地区再直接部署一套服务包(不包含中间件)

但是, 这种由于拉长了服务到中间件的过程, 存在一定的风险, 需要测试去重新覆盖测试